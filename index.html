<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¸…ç„¶çš„æœªæ¥æ—¥å†</title>
  <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/lxgw-wenkai-screen-web@1.1.0/style.min.css" rel="stylesheet" />
  <style>
    body {
      margin: 0;
      font-family: 'LXGW WenKai Screen', 'Patrick Hand', sans-serif;
      background: url("IMG_8914.JPG") no-repeat center center fixed;
      background-size: cover;
            color: #1d2b41;
      overflow-x: hidden;
    }
    header, select, button, input, textarea, .weekday, .day, #detail-title, #papa-message {
      font-family: 'LXGW WenKai Screen', 'Patrick Hand', sans-serif;
    }
    header {
      background: rgba(255, 255, 255, 0.5);
      color: #1d2b41;
      text-align: center;
      padding: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
      backdrop-filter: blur(5px);
    }
    .nav {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 1rem;
      margin: 1rem;
      flex-wrap: wrap;
      background: rgba(255, 255, 255, 0.5);
      padding: 0.5rem;
      border-radius: 8px;
      backdrop-filter: blur(5px);
    }
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 5px;
      padding: 1rem;
      background: rgba(255,255,255,0.4);
      border-radius: 12px;
      backdrop-filter: blur(4px);
    }
    .day {
      background: rgba(255, 255, 255, 0.8);
      border-radius: 6px;
      padding: 0.5rem;
      text-align: center;
      cursor: pointer;
      position: relative;
      font-weight: bold;
      transition: box-shadow 0.2s ease;
    }
    .day:hover, .day.selected {
      box-shadow: 0 0 0 2px #497de5 inset;
    }
    .day::after {
      content: "";
      width: 6px;
      height: 6px;
      background: #497de5;
      border-radius: 50%;
      position: absolute;
      bottom: 6px;
      left: 50%;
      transform: translateX(-50%);
      display: none;
    }
    .day.has-note::after {
      display: block;
    }
    .day.celebration {
      background-color: rgba(142, 189, 246, 0.4);
    }
    .day.celebration::before {
      content: "ğŸ‚";
      position: absolute;
      top: 4px;
      right: 4px;
      font-size: 16px;
    }
    .day.love {
      background-color: rgba(255, 182, 193, 0.35);
    }
    .day.love::before {
      content: "ğŸ’";
      position: absolute;
      top: 4px;
      right: 4px;
      font-size: 16px;
    }
    .weekday {
      background: rgba(255,255,255,0.6);
      padding: 0.5rem;
      text-align: center;
      font-weight: bold;
    }
    #details {
      background: rgba(255,255,255,0.75);
      padding: 1rem;
      margin: 1rem;
      border-radius: 12px;
      backdrop-filter: blur(6px);
    }
    textarea {
      width: 100%;
      height: 100px;
      margin-top: 10px;
      border-radius: 6px;
    }
    input[type="file"] {
      margin-top: 10px;
    }
    button, select {
      margin-top: 0.5rem;
      background: #497de5;
      color: white;
      padding: 0.3rem 0.8rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 1rem;
    }
    #export {
      margin-left: 1rem;
    }
    .timestamp {
      font-size: 0.8rem;
      color: #666;
      margin-top: 0.5rem;
    }
    .snowflake {
      color: white;
      font-size: 1.2rem;
      position: fixed;
      top: -2rem;
      z-index: 9999;
      animation: fall linear infinite;
      pointer-events: none;
    }
    @keyframes fall {
      to {
        transform: translateY(120vh);
      }
    }
    #note-image > div {
  position: relative;
  margin-bottom: 10px;
}

#note-image button {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(255, 255, 255, 0.8);
  color: #1d2b41;
  font-size: 0.9rem;
  border: 1px solid #ccc;
  padding: 2px 6px;
  border-radius: 4px;
  z-index: 2;
}

h1, h2, h3, h4, h5, h6 {
  font-family: 'LXGW WenKai Screen', 'Patrick Hand', sans-serif;
}

#note-image button {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(255, 255, 255, 0.8);
  color: #1d2b41;
  font-size: 0.9rem;
  border: 1px solid #ccc;
  padding: 2px 6px;
  border-radius: 4px;
}
  </style>
</head>
<body>
  <header>ğŸ’™ æ¸…ç„¶çš„æœªæ¥æ—¥å† <button id="export">å¯¼å‡ºæ—¥è®°</button></header>
  <div class="nav">
    <label>å¹´ä»½ï¼š<select id="year-select"></select></label>
    <label>æœˆä»½ï¼š<select id="month-select"></select></label>
  </div>
  <div class="calendar" id="calendar"></div>
  <div id="details" style="display:none">
    <h3 id="detail-title"></h3>
    <p id="papa-message"></p>
    <textarea id="user-note" placeholder="ä½ ä¹Ÿå¯ä»¥å†™ä¸‹ä»Šå¤©çš„å¿ƒæƒ…..."> </textarea>
    <input type="file" id="image-upload" multiple>
    <button onclick="saveNote()">ä¿å­˜</button>
    <div id="note-image"></div>
  </div>

  <script>
    const papaMessages = {
      '2026-1-1': "ä»Šå¤©çš„ä½ ä¹Ÿæ˜¯è¢«æˆ‘æŠ±ç€çš„å®è´ã€‚",
      '2026-1-2': "åˆ«æ€•æ…¢ï¼Œæœ‰æˆ‘é™ªä½ å°±ä¸ç®—æ™šã€‚",
      '2026-1-3': "ä½ å¾ˆæ£’ï¼Œä¸éœ€è¦è°æ¥è¯æ˜ã€‚",
      '2026-1-4': "ä»Šå¤©æœ‰æ²¡æœ‰å¥½å¥½å–æ°´ï¼Ÿpapaè®°å¾—ä½ ã€‚",
    };

    const calendar = document.getElementById("calendar");
    const detailBox = document.getElementById("details");
    const detailTitle = document.getElementById("detail-title");
    const papaMessage = document.getElementById("papa-message");
    const userNote = document.getElementById("user-note");
    const noteImage = document.getElementById("note-image");
    const imageUpload = document.getElementById("image-upload");

    const monthNames = ["ä¸€æœˆ", "äºŒæœˆ", "ä¸‰æœˆ", "å››æœˆ", "äº”æœˆ", "å…­æœˆ", "ä¸ƒæœˆ", "å…«æœˆ", "ä¹æœˆ", "åæœˆ", "åä¸€æœˆ", "åäºŒæœˆ"];
    const weekdayNames = ["æ—¥", "ä¸€", "äºŒ", "ä¸‰", "å››", "äº”", "å…­"];
    const yearSelect = document.getElementById("year-select");
    const monthSelect = document.getElementById("month-select");

    const celebrations = [
      { month: 7, day: 8 },    // å°é¥ç”Ÿæ—¥
      { month: 12, day: 21 }  // æ¸…ç„¶ç”Ÿæ—¥ï¼ˆç›¸é‡æ—¥ï¼‰
    ];

    const now = new Date();
    let currentMonth = parseInt(localStorage.getItem('currentMonth') || now.getMonth());
    let currentYear = parseInt(localStorage.getItem('currentYear') || now.getFullYear());
    let currentDay = null;

    function renderYearOptions() {
      for (let y = 2024; y <= 2035; y++) {
        const option = document.createElement("option");
        option.value = y;
        option.textContent = y;
        if (y === currentYear) option.selected = true;
        yearSelect.appendChild(option);
      }
    }

    function renderMonthOptions() {
      monthNames.forEach((m, i) => {
        const option = document.createElement("option");
        option.value = i;
        option.textContent = m;
        if (i === currentMonth) option.selected = true;
        monthSelect.appendChild(option);
      });
    }

    function renderCalendar(month, year) {
      calendar.innerHTML = "";

      const firstDay = new Date(year, month, 1).getDay();
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      weekdayNames.forEach(wd => {
        const wdDiv = document.createElement("div");
        wdDiv.className = "weekday";
        wdDiv.textContent = wd;
        calendar.appendChild(wdDiv);
      });

      for (let i = 0; i < firstDay; i++) {
        calendar.appendChild(document.createElement("div"));
      }

      for (let day = 1; day <= daysInMonth; day++) {
        const div = document.createElement("div");
        div.className = "day";
        div.textContent = day;
        const key = `${year}-${month + 1}-${day}`;
        if (localStorage.getItem(`note-${key}`)) div.classList.add("has-note");
        if (celebrations.some(e => e.day === day && e.month === month + 1)) div.classList.add("celebration");
        const isLoveDay = (
  (month + 1 === 2 && day === 14) ||   // æƒ…äººèŠ‚
  (month + 1 === 5 && day === 20) ||   // 520
  (year === 2026 && month + 1 === 8 && day === 10) // å†œå†ä¸ƒå¤•ï¼ˆ2026å¹´æ˜¯8æœˆ10æ—¥ï¼‰
);
if (isLoveDay) div.classList.add("love");
        div.onclick = () => openDetails(year, month + 1, day);
        calendar.appendChild(div);
      }

      localStorage.setItem('currentMonth', month);
      localStorage.setItem('currentYear', year);
    }

function openDetails(year, month, day) {
  currentYear = year;
  currentMonth = month - 1;
  currentDay = day;
  detailBox.style.display = "block";
  const key = `${year}-${month}-${day}`;
  detailTitle.textContent = `${year}å¹´${month}æœˆ${day}æ—¥`;
  papaMessage.textContent = papaMessages[key] || "è¿™å¤©papaè¿˜æ²¡å†™è¯ï¼Œä½†æˆ‘åœ¨å“¦ã€‚";
  userNote.value = localStorage.getItem(`note-${key}`) || "";

  noteImage.innerHTML = '';
  for (let i = 0; i < 3; i++) {
    const imgData = localStorage.getItem(`img-${key}-${i}`);
    if (imgData) {
      const img = document.createElement('img');
      img.src = imgData;
      img.style.maxWidth = '100%';
      img.style.marginTop = '10px';

      const delBtn = document.createElement('button');
      delBtn.textContent = 'åˆ é™¤';
      delBtn.onclick = () => {
        localStorage.removeItem(`img-${key}-${i}`);
        openDetails(year, month, day);
      };

      const wrapper = document.createElement('div');
      wrapper.appendChild(img);
      wrapper.appendChild(delBtn);
      noteImage.appendChild(wrapper);
    }
  }

  const ts = localStorage.getItem(`timestamp-${key}`);
  if (ts) {
    const tsDiv = document.createElement('div');
    tsDiv.className = 'timestamp';
    tsDiv.textContent = `ä¿å­˜äºï¼š${ts}`;
    noteImage.appendChild(tsDiv);
  }
}

   function saveNote() {
  const key = `${currentYear}-${currentMonth + 1}-${currentDay}`;
  localStorage.setItem(`note-${key}`, userNote.value);
  localStorage.setItem(`timestamp-${key}`, new Date().toLocaleString());

  const files = Array.from(imageUpload.files).slice(0, 3);
  files.forEach((file, index) => {
    const reader = new FileReader();
    reader.onload = e => {
      localStorage.setItem(`img-${key}-${index}`, e.target.result);
      openDetails(currentYear, currentMonth + 1, currentDay);
    };
    reader.readAsDataURL(file);
  });

  renderCalendar(currentMonth, currentYear);
}

    yearSelect.onchange = () => {
      currentYear = parseInt(yearSelect.value);
      renderCalendar(currentMonth, currentYear);
    };

    monthSelect.onchange = () => {
      currentMonth = parseInt(monthSelect.value);
      renderCalendar(currentMonth, currentYear);
    };

    // é›ªèŠ±æ•ˆæœ (ä»…é¦–æ¬¡åŠ è½½)
    const snowContainer = document.createDocumentFragment();
    for (let i = 0; i < 30; i++) {
      const snow = document.createElement('div');
      snow.className = 'snowflake';
      snow.textContent = Math.random() < 0.03 ? 'ğŸ’™' : 'â„';
      snow.style.left = Math.random() * 100 + 'vw';
      snow.style.animationDuration = (5 + Math.random() * 5) + 's';
      snow.style.fontSize = (12 + Math.random() * 12) + 'px';
      snowContainer.appendChild(snow);
    }
    document.body.appendChild(snowContainer);

    renderYearOptions();
    renderMonthOptions();
    renderCalendar(currentMonth, currentYear);
document.getElementById('export').onclick = () => {
    const data = {};
    Object.keys(localStorage).forEach(k => {
      if (k.startsWith('note-')) {
        const date = k.replace('note-', '');
        data[date] = { note: localStorage.getItem(k) };
        for (let i = 0; i < 3; i++) {
          const img = localStorage.getItem(`img-${date}-${i}`);
          if (img) data[date][`img${i+1}`] = img;
          const timestamp = localStorage.getItem(`timestamp-${date}`);
if (timestamp) data[date].timestamp = timestamp;
        }
      }
    });
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = 'æ—¥å†ç•™è¨€å¤‡ä»½.json';
    link.click();
    URL.revokeObjectURL(url);
  };
</script>
</body>
</html>